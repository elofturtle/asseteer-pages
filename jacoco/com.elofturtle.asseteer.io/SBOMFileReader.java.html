<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sv"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SBOMFileReader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Asseteer</a> &gt; <a href="index.source.html" class="el_package">com.elofturtle.asseteer.io</a> &gt; <span class="el_source">SBOMFileReader.java</span></div><h1>SBOMFileReader.java</h1><pre class="source lang-java linenums">package com.elofturtle.asseteer.io;

import org.cyclonedx.parsers.BomParserFactory;
import org.cyclonedx.exception.ParseException;
import com.elofturtle.asseteer.model.Asset;
import com.elofturtle.asseteer.model.Dependency;
import com.elofturtle.asseteer.model.SBOM;
import java.io.File;
import java.util.ArrayList;

/**
 * Subclasses of Asset reading from a standard format may choose to implement an importer class.
 * This is a parser for the CycloneDX format.
 */
<span class="nc" id="L15">public class SBOMFileReader extends AssetFileReader { </span>
/**
 * Converts selected parts of a cycloneDX SBOM XML file into SBOM:s.
 * @param fp Path to the XML file.
 * @return A list of SBOM Assets.
 */
@Override
public ArrayList&lt;Asset&gt; readFromFile(String fp) {	
	/**
	 * Path to an XML file.
	 */
<span class="nc" id="L26">	File file = new File(fp);</span>
	
	/**
	 * The SBOM list is returned at the end.
	 */
<span class="nc" id="L31">	ArrayList&lt;Asset&gt; sboms = new ArrayList&lt;Asset&gt;();</span>
	
	/**
	 * Before being added to the SBOm list, construct it using this temporary holder.
	 */
	SBOM sbom;
	
	/**
	 * A dummy variable to get the correct id from the SBOM constructor 
	 * (instead of hard-coding it for the Dependency):
	 * Xml-bom-ref --&gt; Asset-bom-ref --&gt; Dependency-id.
	 */
	SBOM dummy;
	
	
<span class="nc bnc" id="L46" title="All 2 branches missed.">	if(!file.exists()) {</span>
<span class="nc" id="L47">		System.out.println(&quot;File not found&quot;);</span>
<span class="nc" id="L48">		System.exit(1);</span>
<span class="nc" id="L49">		return null;</span>
	}
	
	 try {
<span class="nc" id="L53">		 org.cyclonedx.parsers.Parser parser =  BomParserFactory.createParser(file);</span>
<span class="nc" id="L54">		 org.cyclonedx.model.Bom bom = parser.parse(file);</span>
<span class="nc" id="L55">		 var foo = bom.getDependencies();</span>
		 
		 //Metadata for top level component requires special handling
<span class="nc" id="L58">		 sbom = new SBOM();</span>
<span class="nc" id="L59">		 sbom.setName(bom.getMetadata().getComponent().getName());</span>
<span class="nc" id="L60">		 String rawId = bom.getMetadata().getComponent().getPurl();</span>
<span class="nc" id="L61">		 sbom.setId(rawId);</span>
<span class="nc" id="L62">		 sbom.setImportant(true);</span>
<span class="nc" id="L63">		 ArrayList&lt;Dependency&gt; dependencies = new ArrayList&lt;Dependency&gt;();</span>
		 // The XML has a separate listing of dependencies, so we map each entry into a list and add that.
<span class="nc bnc" id="L65" title="All 2 branches missed.">		 for(org.cyclonedx.model.Dependency d : foo) {</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">			 if(rawId.equals(d.getRef())) {</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">				 for(var dd : d.getDependencies()) {</span>
					 //	&quot;SBOM:pkg:abcd@1234, because of differing id naming strategies, 
					 //			create dummy instance that gets correct id from constructor.&quot;
<span class="nc" id="L70">					 dummy = new SBOM();</span>
<span class="nc" id="L71">					 dummy.setId(dd.getRef());</span>
<span class="nc" id="L72">					 dependencies.add(new Dependency(dummy));</span>
<span class="nc" id="L73">				 }</span>
			 }
<span class="nc" id="L75">		 }</span>
<span class="nc" id="L76">		 sbom.setDependencies(dependencies);</span>
<span class="nc" id="L77">		 sboms.add(sbom);</span>
		 
		 // Iterate over every component and add them as well
<span class="nc bnc" id="L80" title="All 2 branches missed.">		 for(var component : bom.getComponents()) {</span>
<span class="nc" id="L81">			 sbom = new SBOM();</span>
<span class="nc" id="L82">			 rawId = component.getPurl();</span>
<span class="nc" id="L83">			 sbom.setId(rawId);</span>
<span class="nc" id="L84">			 sbom.setName(component.getName());</span>
<span class="nc" id="L85">			 dependencies = new ArrayList&lt;Dependency&gt;();</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">			 for(org.cyclonedx.model.Dependency d : foo) {</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">				 if(rawId.equals(d.getRef())){</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">					 if(d.getDependencies() == null)</span>
<span class="nc" id="L89">						 continue;</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">					 for(var dd : d.getDependencies()) {</span>
<span class="nc" id="L91">						 dummy = new SBOM();</span>
<span class="nc" id="L92">						 dummy.setId(dd.getRef());</span>
<span class="nc" id="L93">						 dependencies.add(new Dependency(dummy));</span>
<span class="nc" id="L94">					 }</span>
				 }
<span class="nc" id="L96">			 }</span>
<span class="nc" id="L97">			 sbom.setDependencies(dependencies);</span>
<span class="nc" id="L98">			 sboms.add(sbom);</span>
<span class="nc" id="L99">		 }</span>
<span class="nc" id="L100">	} catch (ParseException e) {</span>
<span class="nc" id="L101">		e.printStackTrace();</span>
<span class="nc" id="L102">	}</span>
<span class="nc" id="L103">	return sboms;</span>
} 
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>